#!/bin/bash
#
# Setup PaGMO
#
. `dirname $0`/common.sh
pagmo_pc_file="`dirname $0`/dependencies/pagmo.pc"
build_dir=`mktemp -d`
trap "rm -rf -- '$build_dir'" EXIT

# Setup environment variables.
export LD_LIBRARY_PATH="$install_dir/lib:$LD_LIBRARY_PATH"
export LD_LIBRARY_PATH="$install_dir/lib/`dpkg-architecture -qDEB_BUILD_MULTIARCH`:$LD_LIBRARY_PATH"
export PKG_CONFIG_PATH="$install_dir/lib/pkgconfig:$PKG_CONFIG_PATH"
export PKG_CONFIG_PATH="$install_dir/lib/`dpkg-architecture -qDEB_BUILD_MULTIARCH`/pkgconfig:$PKG_CONFIG_PATH"

# Clone PaGMO
cd "$build_dir"
git clone --recursive git://github.com/esa/pagmo
cd pagmo
git checkout 1.1.5

# Build PaGMO
mkdir -p build
cd build

cmake .. -DCMAKE_BUILD_TYPE=Release \
         -DCMAKE_INSTALL_PREFIX="$install_dir" \
         -DENABLE_IPOPT=OFF \
         -DBUILD_MAIN=OFF \
         -DBUILD_EXAMPLES=OFF \
         -DENABLE_TESTS=OFF  \
         -DINSTALL_HEADERS=ON \
         -DPYGMO_PYTHON_VERSION=2
make
make install

# pagmo.pc is not automatically generated by PaGMO (yet)
sed -i "s;prefix=/usr;prefix=$install_dir;g" $pagmo_pc_file
cp $pagmo_pc_file "$install_dir/lib/pkgconfig"
